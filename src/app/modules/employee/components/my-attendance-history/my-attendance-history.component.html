<div class="card shadow-xl rounded-lg bg-white p-6 lg:p-8 mt-4 space-y-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-extrabold text-gray-800 mb-6 border-b-2 border-green-500 pb-2">Mi Historial de Asistencia</h1>

        <div class="flex flex-wrap items-center space-y-3 md:space-y-0 md:space-x-4 mb-6 p-4 bg-white rounded-xl shadow-md border">
            
            <h3 class="text-lg font-semibold text-gray-700">Filtrar por:</h3>

            <label for="date-select" class="text-sm font-medium text-gray-700">Día Específico:</label>
            <input type="date" id="date-select" [(ngModel)]="selectedDate" name="selectedDate" 
                   class="p-2 border border-gray-300 rounded-md focus:ring-green-500"
                   (change)="loadAttendanceHistory(true)"> 
            
            <span class="text-gray-400">|</span> 

            <label for="month-select" class="text-sm font-medium text-gray-700">Mes/Año:</label>
            <select id="month-select" [(ngModel)]="selectedMonth" (change)="loadAttendanceHistory(false)"
                    class="p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                <option [ngValue]="1">Enero</option>
                <option [ngValue]="2">Febrero</option>
                <option [ngValue]="3">Marzo</option>
                <option [ngValue]="4">Abril</option>
                <option [ngValue]="5">Mayo</option>
                <option [ngValue]="6">Junio</option>
                <option [ngValue]="7">Julio</option>
                <option [ngValue]="8">Agosto</option>
                <option [ngValue]="9">Septiembre</option>
                <option [ngValue]="10">Octubre</option>
                <option [ngValue]="11">Noviembre</option>
                <option [ngValue]="12">Diciembre</option>
            </select>

            <select id="year-select" [(ngModel)]="selectedYear" (change)="loadAttendanceHistory(false)"
                    class="p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                <option *ngFor="let year of availableYears" [ngValue]="year">{{ year }}</option>
            </select>
            
            <button pButton icon="pi pi-calendar" label="Buscar Período" 
                    (onClick)="loadAttendanceHistory(false)"
                    [loading]="isLoading"
                    styleClass="p-button-sm p-button-success transition duration-300 ml-auto">
            </button>
        </div>

        <p-table [value]="attendanceRecords" 
             [paginator]="true" 
             [rows]="15" 
             [loading]="isLoading"
             styleClass="p-datatable-gridlines p-datatable-striped shadow-xl mt-6">
            
            <ng-template pTemplate="header">
                <tr>
                    <th class="w-1/6">Fecha</th>
                    <th class="w-1/6">Entrada</th>
                    <th class="w-1/6">Salida</th>
                    <th class="w-1/6">Horas Totales</th>
                    <th class="w-2/6">Estado</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-record>
                <tr>
                    <td class="font-bold">{{ record.date | date:'shortDate' }}</td> 
                    
                    <td class="font-medium text-green-700">{{ record.checkInTime || '--' }}</td>
                    <td class="font-medium text-red-700">{{ record.checkOutTime || '--' }}</td>
                    
                    <td class="font-bold">
                        {{ record.totalDuration }} 
                        @if (record.overtimeMinutes > 0) {
                            <span class="text-xs text-red-500 block"> (+ {{ record.overtimeMinutes }}m extra)</span>
                        }
                    </td>
                    
                    <td>
                        <p-tag [value]="record.complete ? 'COMPLETA' : 'INCOMPLETA'" 
                          [severity]="record.complete ? 'success' : 'danger'">
                        </p-tag>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr><td colspan="5" class="text-center py-4 text-gray-500">No se encontraron registros para el período seleccionado.</td></tr>
            </ng-template>
        </p-table>
    </div>
</div>