<div class="card shadow-xl rounded-lg bg-white p-6 lg:p-8 mt-4 space-y-8">
    <h2 class="text-3xl font-bold text-center text-green-700 mb-6">Panel de Solicitudes Laborales</h2>

    <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
        <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Crear Nueva Solicitud</h3>
        
        <form (ngSubmit)="submitRequest()" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <div>
                <label for="requestType" class="block text-sm font-medium text-gray-700">Tipo de Solicitud</label>
                <select id="requestType" name="requestType" [(ngModel)]="newRequest.requestTypeId" required
                        class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    <option [ngValue]="0" disabled>-- Selecciona tipo --</option>
                    @for (type of requestTypes; track type.value) {
                        <option [ngValue]="type.value">{{ type.label }}</option>
                    }
                </select>
            </div>

            <div>
                <label for="manager" class="block text-sm font-medium text-gray-700">Dirigido a:</label>
                <select id="manager" name="managerId" [(ngModel)]="newRequest.managerId" required
                        class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    <option [ngValue]="0" disabled>-- Selecciona destinatario --</option>
                    @for (manager of managersList; track manager.id) {
                        <option [ngValue]="manager.id">
                            {{ manager.fullName }} ({{ manager.roleName | slice:5 }})
                        </option>
                    }
                </select>
                <p class="text-xs text-gray-500 mt-1">Solo Administradores/RRHH visibles.</p>
            </div>

            <div>
                <label for="startDate" class="block text-sm font-medium text-gray-700">Fecha de Inicio</label>
                <input type="date" id="startDate" name="startDate" [(ngModel)]="newRequest.startDate" required
                       class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500">
            </div>

            <div>
                <label for="endDate" class="block text-sm font-medium text-gray-700">Fecha de Fin</label>
                <input type="date" id="endDate" name="endDate" [(ngModel)]="newRequest.endDate" required
                       class="mt-1 block w-full p-2 border rounded-md">
            </div>
            
            <div class="md:col-span-2">
                 <label for="justification" class="block text-sm font-medium text-gray-700">Detalles/Justificación</label>
                <textarea id="justification" name="justification" rows="3" [(ngModel)]="newRequest.details" required
                          class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                          placeholder="Motivo de la solicitud, duración, etc."></textarea>
            </div>
            
            <div class="md:col-span-2 flex justify-end">
                <button type="submit" 
                        [disabled]="isSendingRequest"
                        class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg transition duration-300 disabled:opacity-50 shadow-md">
                    {{ isSendingRequest ? 'Enviando...' : 'Enviar Solicitud' }}
                </button>
            </div>
        </form>
    </div>

    <div class="mt-8">
        <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Historial de Solicitudes Enviadas</h3>
        
        @if (isLoadingHistory) {
            <p class="text-center text-blue-500 p-4">Cargando historial...</p>
        } @else {
            <p-table [value]="requests" 
                    [paginator]="true" 
                    [rows]="5" 
                    styleClass="p-datatable-gridlines p-datatable-striped shadow-md">
                
                <ng-template pTemplate="header">
                    <tr>
                        <th class="w-1/6">Tipo</th>
                        <th>Detalle</th>
                        <th class="w-1/6">Período</th>
                        <th class="w-1/6">Creación</th>
                        <th class="w-1/6">Estado</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-req>
                    <tr>
                        <td class="whitespace-nowrap text-sm font-medium">{{ req.requestType | titlecase }}</td>
                        <td class="whitespace-normal max-w-sm text-sm text-gray-600">{{ req.details }}</td>
                        <td class="whitespace-nowrap text-sm text-gray-600">
                            {{ req.startDate | date:'shortDate' }} - {{ req.endDate | date:'shortDate' }}
                        </td>
                        <td class="whitespace-nowrap text-sm text-gray-600">{{ req.createdAt | date:'mediumDate' }}</td>
                        <td class="whitespace-nowrap">
                            <p-tag [value]="req.status" 
                                [severity]="req.status === 'PENDING' ? 'warn' : (req.status === 'APPROVED' ? 'success' : 'danger')">
                            </p-tag>
                        </td>
                    </tr>
                </ng-template>
                
                <ng-template pTemplate="emptymessage">
                    <tr><td colspan="5" class="text-center py-4 text-gray-500">Aún no has enviado ninguna solicitud.</td></tr>
                </ng-template>
            </p-table>
        }
    </div>
</div>