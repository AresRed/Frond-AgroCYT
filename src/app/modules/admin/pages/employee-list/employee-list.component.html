<p-toast></p-toast>
<p-confirmDialog [style]="{width: '30vw'}" [baseZIndex]="10000"></p-confirmDialog>

<div class="p-6 md:p-10 pt-4 bg-gray-50 min-h-screen">
  <div class="bg-white p-6 rounded-xl shadow-lg border">
    <h1 class="text-3xl font-extrabold text-gray-800 mb-6">Gesti√≥n de Personal</h1>

    <div *ngIf="errorMessage" class="p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg" role="alert">
      <span class="font-medium">Error:</span> {{ errorMessage }}
    </div>

    <p-table #dt [value]="employees" [paginator]="true" [rows]="10" [loading]="isLoading"
      styleClass="p-datatable-gridlines p-datatable-striped" responsiveLayout="scroll"
      [globalFilterFields]="['fullName', 'position', 'username', 'employeeCode', 'status']">

      <ng-template pTemplate="caption">
        <div class="flex flex-col md:flex-row justify-between items-center gap-4">
          <p-button label="Registrar Nuevo" icon="pi pi-user-plus"
            styleClass="p-button-success"
            (click)="router.navigate(['/admin/registrar-nuevo'])"></p-button>

          <p-iconField iconPosition="left">
            <p-inputIcon styleClass="pi pi-search" />
            <input pInputText type="text" (input)="onGlobalFilter(dt, $event)" placeholder="Buscar en la tabla..."
              class="w-full md:w-auto" />
          </p-iconField>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="fullName">Nombre Completo <p-sortIcon field="fullName"></p-sortIcon></th>
          <th pSortableColumn="position">Cargo <p-sortIcon field="position"></p-sortIcon></th>
          <th pSortableColumn="username">Usuario <p-sortIcon field="username"></p-sortIcon></th>
          <th pSortableColumn="roleDisplay">Rol <p-sortIcon field="roleDisplay"></p-sortIcon></th>
          <th pSortableColumn="enabled">Estado <p-sortIcon field="enabled"></p-sortIcon></th>
          <th class="text-center">Acciones</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-emp let-rowIndex="rowIndex">
        <tr *ngIf="!isLoading">
          <td>{{ emp.fullName }}</td>
          <td>{{ emp.position }}</td>
          <td>{{ emp.username }}</td>
          <td>
            <p-tag [value]="emp.roleDisplay"
              [severity]="emp.roleName === 'ROLE_ADMIN' ? 'danger' : (emp.roleName === 'ROLE_RRHH' ? 'warning' : 'info')"></p-tag>
          </td>
          <td>
            <p-tag [value]="emp.enabled ? 'Activo' : 'Inactivo'"
                   [severity]="emp.enabled ? 'success' : 'danger'"></p-tag>
          </td>
          <td class="text-center">
            <div class="flex justify-center space-x-2">
              <p-button icon="pi pi-pencil" styleClass="p-button-sm p-button-info p-button-outlined"
                pTooltip="Editar Empleado" (click)="router.navigate(['/admin/employee/edit', emp.id])"></p-button>
              <p-button [icon]="emp.enabled ? 'pi pi-user-minus' : 'pi pi-user-plus'"
                        [pTooltip]="emp.enabled ? 'Desactivar Cuenta' : 'Activar Cuenta'"
                        [styleClass]="emp.enabled ? 'p-button-sm p-button-danger p-button-outlined' : 'p-button-sm p-button-success p-button-outlined'"
                        (click)="toggleUserStatus(emp)"></p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="loadingbody">
        <tr *ngFor="let i of [].constructor(10)">
          <td><p-skeleton></p-skeleton></td>
          <td><p-skeleton></p-skeleton></td>
          <td><p-skeleton></p-skeleton></td>
          <td><p-skeleton></p-skeleton></td>
          <td><p-skeleton></p-skeleton></td>
          <td><p-skeleton></p-skeleton></td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center py-10">
            <i class="pi pi-users text-4xl text-gray-400 mb-3"></i>
            <p class="text-lg text-gray-600">No se encontraron empleados.</p>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
