

<div class="p-6 md:p-10 pt-4 bg-white rounded-xl shadow-lg border">
  <h1 class="text-3xl font-extrabold text-gray-800 mb-6">Gestión de Horarios y Turnos</h1>

  @if (message) {
      <div [ngClass]="{'bg-green-100 text-green-700 border-green-400': message.type === 'success',
                    'bg-red-100 text-red-700 border-red-400': message.type === 'error'}" 
           class="p-3 mb-6 rounded-md border">
          {{ message.text }}
      </div>
  }

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
    
    <div class="bg-gray-50 p-6 rounded-xl border">
      <h2 class="text-xl font-bold mb-4 text-indigo-700 border-b pb-2">1. Crear Plantilla de Turno</h2>
      
      <form (ngSubmit)="createSchedule()" class="space-y-4">
        
        <input pInputText type="text" [(ngModel)]="newSchedule.name" name="name" placeholder="Nombre del Turno (Ej: Mañana Uva)" required
               class="w-full p-2 border rounded-md">
        
        <div class="grid grid-cols-3 gap-4">
          <div>
            <label class="text-sm text-gray-600">Hora Entrada</label>
            <input type="time" [(ngModel)]="newSchedule.startTime" name="startTime" required
                   class="w-full p-2 border rounded-md">
          </div>
          <div>
            <label class="text-sm text-gray-600">Hora Salida</label>
            <input type="time" [(ngModel)]="newSchedule.endTime" name="endTime" required
                   class="w-full p-2 border rounded-md">
          </div>
          <div>
            <label class="text-sm text-gray-600">Tolerancia (min)</label>
            <input type="number" [(ngModel)]="newSchedule.toleranceMinutes" name="toleranceMinutes" required
                   class="w-full p-2 border rounded-md">
          </div>
        </div>
        
        <p-button type="submit" [label]="isLoading ? 'Guardando...' : 'Guardar Turno'" 
                  icon="pi pi-save" [loading]="isLoading"
                  styleClass="p-button-sm p-button-secondary w-full">
        </p-button>
      </form>
    </div>

    <div class="bg-gray-50 p-6 rounded-xl border">
      <h2 class="text-xl font-bold mb-4 text-teal-700 border-b pb-2">2. Asignar Horario a Empleado</h2>
      
      <form (ngSubmit)="assignSchedule()" class="space-y-4">
        
        <div>
          <label class="text-sm text-gray-600">Empleado</label>
          <p-dropdown [options]="(employees$ | async) ?? []" [(ngModel)]="assignmentForm.employeeId" name="employeeId" required
                      optionLabel="fullName" optionValue="id" placeholder="-- Seleccione Empleado --" [filter]="true" styleClass="w-full">
          </p-dropdown>
        </div>

        <div>
          <label class="text-sm text-gray-600">Turno (Plantilla)</label>
          <p-dropdown [options]="(schedules$ | async) ?? []" [(ngModel)]="assignmentForm.scheduleId" name="scheduleId" required
                      optionLabel="name" optionValue="id" placeholder="-- Seleccione Turno --" styleClass="w-full">
          </p-dropdown>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm text-gray-600">Válido Desde</label>
            <input type="date" [(ngModel)]="assignmentForm.validFrom" name="validFrom" required class="w-full p-2 border rounded-md">
          </div>
          <div>
            <label class="text-sm text-gray-600">Válido Hasta (Opcional)</label>
            <input type="date" [(ngModel)]="assignmentForm.validTo" name="validTo" class="w-full p-2 border rounded-md">
          </div>
        </div>
        
        <div>
          <label class="text-sm text-gray-600 block mb-2">Días Laborables:</label>
          <div class="flex flex-wrap gap-2">
              <p-button pButton *ngFor="let day of weekDays" 
                      type="button"
                      [label]="day.name"
                       (onClick)="toggleDay(day)"
                      [styleClass]="day.selected ? 'p-button-sm p-button-success' : 'p-button-sm p-button-outlined p-button-secondary'">
              </p-button>
          </div>
          <input type="hidden" [(ngModel)]="assignmentForm.workingDays" name="workingDays" />
          <p class="text-xs text-gray-500 mt-2">Cadena enviada: {{ assignmentForm.workingDays }}</p>
        </div>
        
        <p-button type="submit" [label]="isLoading ? 'Asignando...' : 'Asignar Horario'" 
                  icon="pi pi-check" [loading]="isLoading"
                  styleClass="p-button-sm p-button-success w-full mt-4">
        </p-button>
      </form>
    </div>
  </div>
</div>